import{a as $,r as m,j as e,H as F,b as f,R as P}from"./app-_z9UfZ5t.js";import{A}from"./AuthenticatedLayout-ByjtV2Gz.js";import{P as k}from"./PrimaryButton-DZml3sj-.js";import{M as H,S as C}from"./SecondaryButton-bWbD7Y4H.js";import{C as _}from"./Checkbox-BlMFPo_s.js";import"./ApplicationLogo-C7rSYosr.js";import"./Dropdown-DwGj36WW.js";import"./transition-BZJ--MBE.js";const z=()=>{const[l,j]=m.useState("");return P.useEffect(()=>{const p=()=>{const t=new Date,n=t.getHours(),a=Math.ceil((n+1)/6)*6,i=new Date(t);i.setHours(a,0,0,0),i<=t&&i.setDate(i.getDate()+1);const c=i-t,b=Math.floor(c/(1e3*60*60)%24),h=Math.floor(c/(1e3*60)%60),v=Math.floor(c/1e3%60);j(`${b}h ${h}m ${v}s`)};p();const x=setInterval(p,1e3);return()=>clearInterval(x)},[]),e.jsx("span",{className:"font-mono font-bold text-blue-600",children:l})};function U({pendingItems:l,entities:j,auth:p}){const{flash:x}=$().props,[t,n]=m.useState(null),[a,i]=m.useState([]),[c,b]=m.useState(!1),[h,v]=m.useState({}),[g,y]=m.useState(null),S=s=>{n(s);const u=l.find(o=>o.id===s),r=h[s],N=r?{...u.extracted_data,actions:u.extracted_data.actions.map(o=>r.entity_id?{...o,params:{...o.params,entity_id:r.entity_id,entity_name:r.entity_name}}:o)}:u.extracted_data;f.post(route("inbox.confirm",s),{data:N},{onFinish:()=>n(null),onError:o=>console.error("Confirm Error:",o)})},E=s=>{confirm("¿Estás seguro de descartar esta sugerencia?")&&(n(s),f.delete(route("inbox.destroy",s),{onFinish:()=>n(null),onError:u=>console.error("Discard Error:",u)}))},D=()=>{b(!0),f.post(route("inbox.scan"),{},{onFinish:()=>b(!1),onError:s=>console.error("Scan Error:",s)})},M=()=>{confirm(`¿Confirmar ${a.length} elementos?`)&&(n("bulk"),f.post(route("inbox.bulk-confirm"),{ids:a},{onFinish:()=>{n(null),i([])},onError:s=>console.error("Bulk Confirm Error:",s)}))},B=()=>{confirm(`¿Descartar ${a.length} elementos?`)&&(n("bulk"),f.post(route("inbox.bulk-destroy"),{ids:a},{onFinish:()=>{n(null),i([])},onError:s=>console.error("Bulk Discard Error:",s)}))},I=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(s);return e.jsxs(A,{user:p.user,header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:["Bandeja de Confirmación (",l.length,")"]}),e.jsx(k,{onClick:D,disabled:c,className:c?"opacity-75 cursor-wait":"",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Escaneando..."]}):"Escanear Ahora"})]}),children:[e.jsx(F,{title:"Por Confirmar"}),e.jsx(H,{show:!!g,onClose:()=>y(null),maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Detalle de Extracción (Diff View)"}),g&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 h-96 overflow-y-auto font-mono text-xs",children:[e.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[e.jsx("h3",{className:"font-bold text-gray-500 mb-2 uppercase",children:"Raw Data (Source)"}),e.jsx("pre",{className:"whitespace-pre-wrap break-words text-gray-600",children:JSON.stringify(g.raw_data,null,2)})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-100",children:[e.jsx("h3",{className:"font-bold text-blue-500 mb-2 uppercase",children:"Extracted (AI)"}),e.jsx("pre",{className:"whitespace-pre-wrap break-words text-blue-800",children:JSON.stringify(g.extracted_data,null,2)})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(C,{onClick:()=>y(null),children:"Cerrar"})})]})}),a.length>0&&e.jsx("div",{className:"fixed bottom-0 inset-x-0 pb-6 pointer-events-none z-50",children:e.jsx("div",{className:"max-w-xl mx-auto px-4 pointer-events-auto",children:e.jsxs("div",{className:"bg-gray-900 text-white rounded-lg shadow-xl p-4 flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium px-2",children:[a.length," seleccionados"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:B,disabled:t==="bulk",className:"px-3 py-1.5 text-sm bg-red-600 hover:bg-red-500 rounded transition",children:"Descartar"}),e.jsx("button",{onClick:M,disabled:t==="bulk",className:"px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-500 rounded transition font-bold",children:"Confirmar"})]})]})})}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[x.success&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",children:x.success}),x.error&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:x.error}),l.length===0?e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-12 text-center text-gray-500",children:[e.jsx("div",{className:"rounded-full bg-blue-50 p-6 w-24 h-24 mx-auto mb-6 flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"¡Todo al día!"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-sm mx-auto",children:"No tienes sugerencias pendientes. Tu asistente financiero está monitoreando en segundo plano."}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 inline-block border border-gray-100",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Siguiente escaneo automático en: ",e.jsx(z,{})]})}),e.jsx("p",{className:"text-xs text-gray-400 mt-4",children:"O puedes iniciar un escaneo manual cuando quieras."})]}):e.jsxs("div",{className:"mb-4 flex items-center gap-2 px-1",children:[e.jsx(_,{checked:a.length===l.length&&l.length>0,onChange:toggleAll}),e.jsx("span",{className:"text-sm text-gray-600",children:"Seleccionar todos"})]}),l.length>0&&e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:l.map(s=>{const r=s.extracted_data.actions?.[0]?.params||{},N=r.value||r.amount||0,o=r.description||s.raw_data.subject||s.raw_data.summary,w=a.includes(s.id),L=(h[s.id]||{}).entity_id||r.entity_id||"";return e.jsxs("div",{className:`bg-white overflow-hidden shadow-sm sm:rounded-lg border transition-all flex flex-col relative ${w?"border-blue-500 ring-2 ring-blue-200":"border-gray-200"}`,children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(_,{checked:w,onChange:()=>toggleSelection(s.id)})}),e.jsx("div",{className:`h-2 w-full ${s.confidence_score>80?"bg-green-500":s.confidence_score>50?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{className:"p-6 flex-1 pt-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${s.source_type==="gmail"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:s.source_type.toUpperCase()}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("button",{onClick:()=>y(s),className:"text-xs text-gray-400 hover:text-blue-500",title:"Ver original vs extraído",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})})})]})]}),e.jsx("h3",{className:"font-bold text-lg mb-2 truncate",title:o,children:o}),e.jsx("div",{className:"text-3xl font-bold text-gray-800 mb-4",children:I(N)}),s.requires_manual_review&&e.jsxs("div",{className:"bg-red-50 text-red-700 text-xs p-2 rounded mb-4 border border-red-100",children:["⚠️ ",e.jsx("strong",{children:"Revisión requerida:"})," ",s.review_reason]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[r.date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Fecha:"}),e.jsx("span",{className:"font-medium",children:r.date})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Entidad:"}),e.jsxs("select",{value:L,onChange:d=>handleEntityChange(s.id,d.target.value),className:"text-xs py-1 px-2 border-gray-300 rounded shadow-sm focus:border-blue-500 focus:ring-blue-500 max-w-[150px]",onClick:d=>d.stopPropagation(),children:[e.jsx("option",{value:"",children:"Seleccionar..."}),j.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Confianza:"}),e.jsxs("span",{className:`font-medium ${s.confidence_score<70?"text-orange-500":"text-green-600"}`,children:[s.confidence_score,"%"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-between gap-3",children:[e.jsx(C,{onClick:()=>E(s.id),disabled:t===s.id,className:"w-full justify-center !text-red-600 hover:!bg-red-50",children:"Descartar"}),e.jsx(k,{onClick:()=>S(s.id),disabled:t===s.id,className:"w-full justify-center",children:t===s.id?"...":h[s.id]?"Guardar":"Confirmar"})]})]},s.id)})})]})})]})}export{U as default};
