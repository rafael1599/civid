import{r as a,j as e,b as O,L as B}from"./app-_z9UfZ5t.js";import{d as _}from"./transition-BZJ--MBE.js";function A({isOpen:o,onClose:c}){const[n,l]=a.useState(""),[u,i]=a.useState(!1),[d,b]=a.useState(!1),[w,y]=a.useState(null),[N,F]=a.useState(""),[D,E]=a.useState(""),[m,p]=a.useState(null),[f,r]=a.useState(null),[L,T]=a.useState([]),j=a.useRef(null),k=a.useRef(null),x=a.useRef(null);a.useEffect(()=>{o&&k.current&&k.current.focus()},[o]),a.useEffect(()=>()=>{x.current&&clearTimeout(x.current)},[]);const v=(t=5)=>{x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{c(),p(null),r(null),l("")},t*1e3)};a.useEffect(()=>{d&&L.length===0&&window.axios.get(route("api.entities.index")).then(t=>T(t.data)).catch(t=>console.error("Failed to load entities",t))},[d]);const R=async t=>{if(t.preventDefault(),!!n.trim()){i(!0),p(null),r(null),x.current&&clearTimeout(x.current);try{const s=await window.axios.post(route("ingest"),{prompt:n});s.data.success&&(s.data.auto_executed?(r({type:"success",message:s.data.message}),l(""),v(5)):p(s.data.draft))}catch(s){console.error("Ingestion failed",s),s.response?.status===419?r({type:"error",message:"Sesión expirada. Recarga la página."}):s.response?.status===422?r({type:"info",message:s.response.data.message,suggestions:s.response.data.suggestions||[]}):r({type:"error",message:"No pude procesar eso."})}finally{i(!1)}}},I=()=>{i(!0),m?.actions?.length&&O.post(route("ingest.execute"),{actions:m.actions},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{p(null),r({type:"success",message:"Ejecutado correctamente."}),l(""),i(!1),v(5)},onError:t=>{r({type:"error",message:"Error: "+Object.values(t).join(", ")}),i(!1)}})},M=async t=>{const s=t.target.files[0];if(!s)return;if(d){y(s),E(s.name);return}i(!0),p(null),r(null);const h=new FormData;h.append("file",s);try{const g=await window.axios.post(route("ingest"),h,{headers:{"Content-Type":"multipart/form-data"}});g.data.success&&(g.data.auto_executed?(r({type:"success",message:g.data.message}),v(5)):p(g.data.draft))}catch{r({type:"error",message:"Error al subir archivo."})}finally{i(!1),j.current&&(j.current.value="")}},z=async t=>{if(t?.preventDefault(),!w||!N)return;i(!0);const s=new FormData;s.append("file",w),s.append("entity_id",N),s.append("name",D);try{await window.axios.post(route("documents.store"),s),y(null),b(!1),r({type:"success",message:"Documento guardado."}),i(!1),v(3)}catch{r({type:"error",message:"Error al guardar documento."}),i(!1)}};return o?e.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col justify-end items-center p-4 pb-24 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-black/5 backdrop-blur-[2px] pointer-events-auto",onClick:c}),e.jsxs("div",{className:"relative w-full max-w-xl pointer-events-auto animate-in slide-in-from-bottom-5 duration-300",children:[e.jsxs("div",{className:"mb-4 space-y-3",children:[f&&!m&&e.jsxs("div",{className:`p-4 rounded-2xl shadow-xl border animate-in fade-in zoom-in duration-200 ${f.type==="error"?"bg-rose-50 text-rose-700 border-rose-100":f.type==="success"?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-white text-gray-800 border-gray-100"}`,children:[e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsx("p",{className:"text-sm font-medium",children:f.message}),e.jsx("button",{onClick:()=>r(null),className:"opacity-50",children:"✕"})]}),f.suggestions&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:f.suggestions.map((t,s)=>e.jsxs("button",{onClick:()=>l(t),className:"text-[10px] bg-black/5 px-2 py-1 rounded-lg hover:bg-black/10 transition font-medium",children:['"',t,'"']},s))})]}),m&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl border border-indigo-100 p-6 animate-in zoom-in fade-in duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-indigo-600",children:"Plan de Acción"}),e.jsx("button",{onClick:()=>p(null),className:"text-gray-300 hover:text-gray-500 transition-colors",children:"✕"})]}),m.analysis&&e.jsx("div",{className:"mb-6 p-4 bg-indigo-50/30 rounded-2xl border border-indigo-100/50",children:e.jsx("p",{className:"text-xs text-indigo-900 leading-relaxed font-medium",children:m.analysis})}),e.jsx("div",{className:"space-y-3 max-h-[30vh] overflow-y-auto pr-2 custom-scrollbar",children:m.actions?.map((t,s)=>e.jsxs("div",{className:"bg-gray-50/50 p-4 rounded-2xl border border-gray-100/50 text-xs text-gray-700 flex flex-col gap-1",children:[e.jsx("span",{className:"font-black text-indigo-500 uppercase tracking-wider text-[9px]",children:t.tool}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-1",children:Object.entries(t.params).map(([h,g])=>e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] text-gray-400 block uppercase font-bold",children:h}),e.jsx("span",{className:"font-medium truncate block",children:String(g)})]},h))})]},s))}),e.jsx("button",{onClick:I,disabled:u,className:"w-full mt-6 py-4 bg-indigo-600 text-white rounded-2xl font-black text-[10px] uppercase tracking-[0.2em] shadow-xl shadow-indigo-600/20 hover:bg-indigo-700 transition-all active:scale-[0.98]",children:u?"Ejecutando...":"Confirmar Todo"})]}),d&&w&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl border border-amber-100 p-6 animate-in zoom-in duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-amber-600 text-center flex-1",children:"Archivo Detectado"}),e.jsx("button",{onClick:()=>y(null),className:"text-gray-300",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{value:D,onChange:t=>E(t.target.value),className:"w-full text-sm rounded-2xl border-gray-100 bg-gray-50 py-3 px-4 focus:ring-amber-500",placeholder:"Nombre..."}),e.jsxs("select",{value:N,onChange:t=>F(t.target.value),className:"w-full text-sm rounded-2xl border-gray-100 bg-gray-50 py-3 px-4 focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"Seleccionar Entidad"}),L.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("button",{onClick:z,className:"w-full py-4 bg-amber-500 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-amber-500/20",children:"Guardar en Bóveda"})]})]})]}),e.jsxs("form",{onSubmit:R,className:"bg-white/95 backdrop-blur-xl rounded-[2.5rem] shadow-2xl border border-white p-2 flex items-center gap-1 group",children:[e.jsx("button",{type:"button",onClick:()=>{b(!d),y(null)},className:`p-4 rounded-full transition-all ${d?"bg-amber-100 text-amber-600 scale-110":"text-gray-400 hover:bg-gray-50"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})})}),e.jsx("input",{ref:k,value:n,onChange:t=>l(t.target.value),placeholder:"¿Qué quieres registrar?",className:"flex-1 bg-transparent border-none focus:ring-0 text-gray-800 placeholder-gray-400 text-sm font-medium py-3",disabled:u}),e.jsx("input",{type:"file",ref:j,onChange:M,className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>j.current?.click(),className:"p-4 text-gray-400 hover:text-indigo-600 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.414a4 4 0 00-5.656-5.656l-6.415 6.414a6 6 0 108.486 8.486L20.5 13"})})}),e.jsx("button",{type:"submit",disabled:u||!n.trim(),className:"p-4 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 disabled:opacity-20 transition-all active:scale-95",children:u?e.jsx("div",{className:"w-5 h-5 border-2 border-white/20 border-t-white rounded-full animate-spin"}):e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]})]})]}):null}const C=a.createContext(),S=({children:o})=>{const[c,n]=a.useState(!1),l=()=>{n(u=>!u)};return e.jsx(C.Provider,{value:{open:c,setOpen:n,toggleOpen:l},children:e.jsx("div",{className:"relative",children:o})})},$=({children:o})=>{const{open:c,setOpen:n,toggleOpen:l}=a.useContext(C);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:l,children:o}),c&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>n(!1)})]})},G=({align:o="right",width:c="48",contentClasses:n="py-1 bg-white",children:l})=>{const{open:u,setOpen:i}=a.useContext(C);let d="origin-top";o==="left"?d="ltr:origin-top-left rtl:origin-top-right start-0":o==="right"&&(d="ltr:origin-top-right rtl:origin-top-left end-0");let b="";return c==="48"&&(b="w-48"),e.jsx(e.Fragment,{children:e.jsx(_,{show:u,enter:"transition ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsx("div",{className:`absolute z-50 mt-2 rounded-md shadow-lg ${d} ${b}`,onClick:()=>i(!1),children:e.jsx("div",{className:"rounded-md ring-1 ring-black ring-opacity-5 "+n,children:l})})})})},U=({className:o="",children:c,...n})=>e.jsx(B,{...n,className:"block w-full px-4 py-2 text-start text-sm leading-5 text-gray-700 transition duration-150 ease-in-out hover:bg-gray-100 focus:bg-gray-100 focus:outline-none "+o,children:c});S.Trigger=$;S.Content=G;S.Link=U;export{S as D,A as G};
